!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("prejudice",[],t):"object"==typeof exports?exports.prejudice=t():e.prejudice=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=5)}([function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){n(this,e),this.apply=this.apply.bind(this),this.actionBaseUrl="",this.apply=this.apply.bind(this),this.registerBaseUrl=this.registerBaseUrl.bind(this)}return o(e,[{key:"apply",value:function(e,t,r){return r({status:"Success"}),this}},{key:"registerBaseUrl",value:function(e){return this.baseUrl=e,this}}]),e}();t.default=i,e.exports=t.default},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){n(this,e),this.records={},this.observers=[],this.addObserver=this.addObserver.bind(this),this.notifyObservers=this.notifyObservers.bind(this),this.add=this.add.bind(this),this.remove=this.remove.bind(this),this.clear=this.clear.bind(this),this.list=this.list.bind(this),this.count=this.count.bind(this),this.findIndex=this.findIndex.bind(this)}return o(e,[{key:"notifyObservers",value:function(){return this.observers.forEach(function(e){e(this.records)},this),this}},{key:"addObserver",value:function(e){return this.observers.push(e),this}},{key:"add",value:function(e){return-1===this.findIndex(e)&&(this.records[e.datastore]=this.records[e.datastore]||[],this.records[e.datastore].push(e),this.notifyObservers(),!0)}},{key:"findIndex",value:function(e){return this.records[e.datastore]?this.records[e.datastore].findIndex(function(t){return t.datastore===e.datastore&&t.uid===e.uid}):-1}},{key:"remove",value:function(e){var t=this.findIndex(e);return t>=0&&(this.records[e.datastore].splice(t,1),this.notifyObservers(),!0)}},{key:"clear",value:function(e){return e&&this.count(e)>0?(this.records[e]={},this.notifyObservers(),!0):this.count()>0&&(this.records={},this.notifyObservers(),!0)}},{key:"list",value:function(e){if(e)return this.records[e]||[];var t=[];return Object.keys(this.records).forEach(function(e){t=t.concat(this.list(e))},this),t}},{key:"count",value:function(e){if(e)return this.list(e).length;var t=0;return Object.keys(this.records).forEach(function(e){t+=this.count(e)},this),t}}]),e}();t.default=new i,t.VariableStorageDriver=i},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){n(this,e),this.engine=null,this.registerEngine=this.registerEngine.bind(this)}return o(e,[{key:"registerEngine",value:function(e){this.engine=e}}]),e}();t.default=i,e.exports=t.default},function(e,t,r){"use strict";(function(n){function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)},s=r(2),f=function(e){function t(e,r){o(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return u.key=r,u.storage=e,u.read(),n.window.addEventListener("storage",function(e){return function(t){t.storageArea===e.storage&&(e.read(),e.notifyObservers())}}(u)),u.read=u.read.bind(u),u.write=u.write.bind(u),u}return u(t,e),a(t,[{key:"read",value:function(){try{this.records=JSON.parse(this.storage.getItem(this.key))||{}}catch(e){this.records={}}return this}},{key:"write",value:function(){return this.storage.setItem(this.key,JSON.stringify(this.records)),this}},{key:"add",value:function(e){return!!c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e)&&(this.write(),!0)}},{key:"remove",value:function(e){return!!c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"remove",this).call(this,e)&&(this.write(),!0)}},{key:"clear",value:function(e){return!!c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clear",this).call(this,e)&&(this.write(),!0)}}]),t}(s.VariableStorageDriver);t.default=f,e.exports=t.default}).call(t,r(1))},function(e,t,r){"use strict";(function(n){function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(6),c=o(a),s=r(7),f=o(s),l=r(2),d=o(l),h=r(0),p=o(h),b=r(8),y=o(b),v=r(9),_=o(v),O=r(10),g=o(O),w=r(11),j=o(w),P=r(12),R=o(P),m=r(3),k=o(m),E=r(13),x=o(E),T=r(14),S=o(T),M=r(15),D=o(M),U=r(16),C=o(U),B=function(){function e(t){i(this,e),this.recordStorage=c.default,this.actions={text:y.default,email:_.default,favorites:g.default,file:j.default},this.datastores={},this.addObserver=this.addObserver.bind(this),this.setRecordStorage=this.setRecordStorage.bind(this),this.addRecord=this.addRecord.bind(this),this.listRecords=this.listRecords.bind(this),this.removeRecord=this.removeRecord.bind(this),this.act=this.act.bind(this),this.clearRecords=this.clearRecords.bind(this),this.registerRecordEngine=this.registerRecordEngine.bind(this),this.resolveRecord=this.resolveRecord.bind(this),this.registerDatastore=this.registerDatastore.bind(this),this.registerActionBaseUrl=this.registerActionBaseUrl.bind(this),t.recordEngine&&this.registerRecordEngine(t.recordEngine),t.datastores&&t.datastores.forEach(function(e){e.slug&&e.uid&&(this.datastores[e.uid]=[t.baseUrl||n.window.location.origin,e.slug,"record"].join("/"))},this),t.actionBaseUrl&&this.registerActionBaseUrl(t.actionBaseUrl)}return u(e,[{key:"registerActionBaseUrl",value:function(e){return Object.values(this.actions).forEach(function(t){t.registerBaseUrl(e)},this),this}},{key:"registerDatastore",value:function(e,t){return this.datastores[e]=t,this}},{key:"registerRecordEngine",value:function(t){return e.Driver.Record.UidHash.registerEngine(t),e.Driver.Record.ReactHash.registerEngine(t),e.Driver.Record.Pride.registerEngine(t),this}},{key:"addObserver",value:function(e){return this.recordStorage.addObserver(e),this}},{key:"setRecordStorage",value:function(e){return this.recordStorage=e,this}},{key:"addRecord",value:function(e){return e=this.resolveRecord(e),e.renderFull(function(e,t){return function(r){r.has_holdings?e.getHoldings(function(e,t){return function(r){t.rawHoldings=r,e.add(t)}}(t,r)):t.add(r)}}(e,this.recordStorage)),this}},{key:"resolveRecord",value:function(t){return e.Driver.Record.ReactHash.match(t)?e.Driver.Record.ReactHash.dataToRecord(t):e.Driver.Record.UidHash.match(t)?e.Driver.Record.UidHash.dataToRecord(t):e.Driver.Record.Pride.match(t)?e.Driver.Record.Pride.dataToRecord(t):e.Driver.Record.Null.dataToRecord(t)}},{key:"listRecords",value:function(e){return this.recordStorage.list(e)}},{key:"countRecords",value:function(e){return this.recordStorage.count(e)}},{key:"removeRecord",value:function(e){return e=this.resolveRecord(e),e.renderFull(function(e){return function(t){e.remove(t)}}(this.recordStorage)),this}},{key:"act",value:function(e,t,r,n){return this.actions[e].apply(this.listRecords(t),r,n),this}},{key:"clearRecords",value:function(e){return this.recordStorage.clear(e),this}}]),e}();Object.defineProperty(B,"SessionStorageDriver",{value:c.default}),Object.defineProperty(B,"LocalStorageDriver",{value:f.default}),Object.defineProperty(B,"VariableStorageDriver",{value:d.default}),Object.defineProperty(B,"Action",{value:p.default}),Object.defineProperty(B.Action,"Text",{value:y.default}),Object.defineProperty(B.Action,"Email",{value:_.default}),Object.defineProperty(B.Action,"File",{value:j.default}),Object.defineProperty(B.Action,"Favorites",{value:g.default}),Object.defineProperty(B,"Driver",{value:R.default}),Object.defineProperty(B.Driver,"Record",{value:k.default}),Object.defineProperty(B.Driver.Record,"UidHash",{value:x.default}),Object.defineProperty(B.Driver.Record,"ReactHash",{value:S.default}),Object.defineProperty(B.Driver.Record,"Pride",{value:D.default}),Object.defineProperty(B.Driver.Record,"Null",{value:C.default}),t.default=B,e.exports=t.default}).call(t,r(1))},function(e,t,r){"use strict";(function(n){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),u=o(i),a=r(4),c=o(a),s=u.default;void 0!==n.window&&(s=new c.default(n.window.sessionStorage,"Prejudice.sessionStorage")),t.default=s,e.exports=t.default}).call(t,r(1))},function(e,t,r){"use strict";(function(n){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),u=o(i),a=r(4),c=o(a),s=u.default;void 0!==n.window&&(s=new c.default(n.window.localStorage,"Prejudice.localStorage")),t.default=s,e.exports=t.default}).call(t,r(1))},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.path="text",e}return i(t,e),t}(a.default);t.default=new c,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.path="email",e}return i(t,e),t}(a.default);t.default=new c,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.path="favorites",e}return i(t,e),t}(a.default);t.default=new c,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=r(0),a=function(e){return e&&e.__esModule?e:{default:e}}(u),c=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.path="file",e}return i(t,e),t}(a.default);t.default=new c,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(){n(this,e)};t.default=o,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(3),c=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.dataToRecord=e.dataToRecord.bind(e),e.match=e.match.bind(e),e}return i(t,e),u(t,[{key:"match",value:function(e){return e.datastoreUid&&e.recordUid}},{key:"dataToRecord",value:function(e){return this.engine.requestRecord(e.datastoreUid,e.recordUid)}}]),t}(c.default);t.default=new s,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(3),c=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.dataToRecord=e.dataToRecord.bind(e),e.match=e.match.bind(e),e}return i(t,e),u(t,[{key:"match",value:function(e){return e.datastore&&e.uid}},{key:"dataToRecord",value:function(e){return this.engine.requestRecord(e.datastore,e.uid)}}]),t}(c.default);t.default=new s,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(3),c=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.dataToRecord=e.dataToRecord.bind(e),e.match=e.match.bind(e),e}return i(t,e),u(t,[{key:"match",value:function(e){return e instanceof this.engine.Core.Record}},{key:"dataToRecord",value:function(e){return e}}]),t}(c.default);t.default=new s,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){n(this,e)}return o(e,[{key:"match",value:function(e){return!1}},{key:"dataToRecord",value:function(){return this}}]),e}();t.default=new i,e.exports=t.default}])});